(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{6307:function(e,t,a){Promise.resolve().then(a.bind(a,4468))},4468:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return q}});var r=a(7437),s=a(2265),l=a(3949),n=a(5719),i=a(7168),o=a(9322),c=a(1671),d=a(8906),h=a(2660),g=a(7648),u=a(6865),x=a(7117),m=a(9658),p=a(2489),b=a(7689),f=a(3245);let w=e=>{let{onFileSelect:t,loading:a=!1,error:n,className:i}=e,{t:o}=(0,l.$G)(),[c,d]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),[w,y]=(0,s.useState)(""),v=(0,s.useCallback)(e=>"application/pdf"!==e.type?o("fileUploader.validation.formatError"):e.size>52428800?o("fileUploader.validation.sizeError"):null,[o]),j=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?(d(!0),y("")):"dragleave"===e.type&&d(!1)},[]),N=(0,s.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),d(!1),y(""),e.dataTransfer.files&&e.dataTransfer.files[0]){let a=e.dataTransfer.files[0],r=v(a);if(r){y(r);return}g(a),t(a)}},[t,v]),k=(0,s.useCallback)(e=>{if(y(""),e.target.files&&e.target.files[0]){let a=e.target.files[0],r=v(a);if(r){y(r),e.target.value="";return}g(a),t(a)}},[t,v]),C=(0,s.useCallback)(()=>{g(null),y("")},[]);return(0,r.jsxs)("div",{className:"w-full max-w-2xl mx-auto ".concat(i||""),children:[(0,r.jsxs)("div",{className:"\n          relative border-4 border-dashed rounded-none p-8 text-center transition-all duration-300\n          ".concat(c?"border-blue-600 bg-blue-50 scale-[1.02]":w?"border-red-500 bg-red-50":"border-black hover:bg-yellow-50 hover:border-black","\n          ").concat(a?"pointer-events-none opacity-60":"cursor-pointer","\n          ").concat(h&&!w?"border-green-600 bg-green-50":"","\n        "),onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:N,onClick:()=>{var e;return!a&&(null===(e=document.getElementById("file-input"))||void 0===e?void 0:e.click())},children:[(0,r.jsx)("input",{id:"file-input",type:"file",accept:".pdf,application/pdf",onChange:k,className:"hidden",disabled:a}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center space-y-4",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 bg-blue-100 border-2 border-black rounded-full",children:(0,r.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}),(0,r.jsxs)("div",{className:"text-black",children:[(0,r.jsx)("p",{className:"text-lg font-black",children:o("fileUploader.loading.title")}),(0,r.jsx)("p",{className:"text-sm font-bold text-blue-600 mt-1",children:o("fileUploader.loading.description")})]})]}):w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 bg-red-100 border-2 border-black rounded-full",children:(0,r.jsx)(u.Z,{className:"w-8 h-8 text-red-600"})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-xl font-black text-red-800",children:o("fileUploader.validation.failed")}),(0,r.jsx)("p",{className:"text-red-600 font-bold",children:w}),(0,r.jsx)("p",{className:"text-sm font-bold text-gray-500",children:o("fileUploader.validation.selectValid")})]})]}):h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 bg-green-100 border-2 border-black rounded-full",children:(0,r.jsx)(x.Z,{className:"w-8 h-8 text-green-600"})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-3 text-green-800",children:[(0,r.jsx)(m.Z,{className:"w-6 h-6"}),(0,r.jsx)("span",{className:"text-lg font-black max-w-xs truncate",children:h.name}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),C()},className:"p-1 hover:bg-red-200 rounded-full text-red-600 transition-colors border-2 border-transparent hover:border-red-600",title:o("fileUploader.remove"),children:(0,r.jsx)(p.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("p",{className:"text-sm font-bold text-green-700",children:[(e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]})(h.size)," • ",o("fileUploader.clickToReselect")]})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 bg-yellow-300 border-2 border-black rounded-full shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:(0,r.jsx)(b.Z,{className:"w-8 h-8 text-black"})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-2xl font-black text-black uppercase",children:o("fileUploader.dragDrop.title")}),(0,r.jsxs)("p",{className:"text-gray-600 font-bold",children:[o("fileUploader.dragDrop.subtitle")," ",(0,r.jsx)("span",{className:"text-blue-600 underline decoration-2",children:o("fileUploader.dragDrop.clickToSelect")})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4 pt-4",children:[(0,r.jsx)("div",{className:"flex items-center text-xs font-bold text-gray-500 bg-white px-2 py-1 border border-black",children:o("fileUploader.maxSize")}),(0,r.jsx)("div",{className:"flex items-center text-xs font-bold text-gray-500 bg-white px-2 py-1 border border-black",children:o("fileUploader.pdfOnly")}),(0,r.jsx)("div",{className:"flex items-center text-xs font-bold text-gray-500 bg-white px-2 py-1 border border-black",children:o("fileUploader.localProcessing")})]}),(0,r.jsx)("div",{className:"mt-6 p-3 bg-blue-50 border-2 border-black",children:(0,r.jsxs)("div",{className:"flex items-center text-blue-900 font-bold",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-xs",children:o("fileUploader.privacy.description")})]})})]})]})})]}),n&&(0,r.jsx)("div",{className:"mt-4 p-4 bg-red-50 border-2 border-black shadow-[4px_4px_0px_0px_rgba(220,38,38,1)]",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 text-red-600 mr-3"}),(0,r.jsx)("p",{className:"text-red-900 text-sm font-black",children:n})]})})]})};var y=a(2451),v=a(407),j=a(1473),N=a(7586),k=a(5802),C=a(3391),P=a(9076),R=a(7416),M=a(1740),S=a(875),E=a(3247);let D=e=>{let{currentPage:t,totalPages:a,onPageChange:n}=e,{t:i}=(0,l.$G)(),[o,c]=(0,s.useState)(!1),[d,h]=(0,s.useState)(""),g=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let u=Array.from({length:a},(e,t)=>t+1).filter(e=>""===d||e.toString().includes(d)),x=e=>{n(e),c(!1),h("")};return(0,r.jsxs)("div",{className:"relative",ref:g,children:[(0,r.jsxs)("button",{onClick:()=>c(!o),className:"flex items-center space-x-1 px-3 py-1.5 text-sm font-medium bg-gray-50 rounded-md hover:bg-gray-100 transition-colors min-w-[80px] justify-center",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"text-gray-400",children:"/"}),(0,r.jsx)("span",{className:"text-gray-600",children:a}),(0,r.jsx)(S.Z,{className:"w-4 h-4 text-gray-500 ml-1"})]}),o&&(0,r.jsxs)("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 w-64",children:[(0,r.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(E.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:i("nav.searchPage"),value:d,onChange:e=>h(e.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:u.length>0?(0,r.jsx)("div",{className:"p-2",children:u.map(e=>(0,r.jsx)("button",{onClick:()=>x(e),className:"w-full text-left px-3 py-2 rounded-md text-sm transition-colors ".concat(e===t?"bg-blue-100 text-blue-700 font-medium":"hover:bg-gray-100 text-gray-700"),children:i("pdf.page",{number:e})},e))}):(0,r.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:i("pageSelector.noMatch")})}),(0,r.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-600",children:[i("pageSelector.quickJump"),":"]}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("button",{onClick:()=>x(1),disabled:1===t,className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:i("nav.firstPage")}),(0,r.jsx)("button",{onClick:()=>x(a),disabled:t===a,className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:i("nav.lastPage")})]})]})})]})]})},F=e=>{let{file:t,onRenderPage:a,redactionRects:n,currentPage:i,totalPages:o,onPageChange:c,onViewModeChange:d,loading:h=!1,previewMode:g=!1}=e,{t:u}=(0,l.$G)(),[x,m]=(0,s.useState)(1.2),[p,b]=(0,s.useState)(new Map),[f,w]=(0,s.useState)(new Set),y=(0,s.useRef)(null),v=(0,s.useRef)(null),N=(0,s.useRef)(new Set),R=(0,s.useCallback)(e=>{let t=n[e-1]||[];return"".concat(e,"-").concat(x.toFixed(2),"-").concat(t.length,"-").concat(JSON.stringify(t))},[n,x]),M=(0,s.useCallback)(async e=>{if(!t||f.has(e)||N.current.has(e))return;let r=R(e),s=p.get(e);if(!s||s.hash!==r){N.current.add(e),w(t=>new Set([...t,e]));try{let t=Math.min(1.2*x,1.5),s=await a(e,t);if(s.success&&s.imageData){let t=document.createElement("canvas"),a=window.devicePixelRatio||1,l=t.getContext("2d",{alpha:!1,imageSmoothingEnabled:!0,imageSmoothingQuality:"high",willReadFrequently:!1});if(!l)return;let i=.8*s.width,o=.8*s.height;t.width=i*a,t.height=o*a,t.style.width="".concat(i,"px"),t.style.height="".concat(o,"px"),l.scale(a,a);let c=document.createElement("canvas");c.width=s.width,c.height=s.height,c.getContext("2d",{alpha:!1}).putImageData(s.imageData,0,0),l.drawImage(c,0,0,i,o);let d=n[e-1]||[];d.length>0&&(l.save(),d.forEach(e=>{let t=e.x/e.pageWidth*i,a=e.y/e.pageHeight*o,r=e.width/e.pageWidth*i,s=e.height/e.pageHeight*o;if(g)l.fillStyle="#000000",l.fillRect(t,a,r,s);else{let n=e.color||"red",o={red:"rgba(239, 68, 68, 0.35)",blue:"rgba(59, 130, 246, 0.35)",green:"rgba(34, 197, 94, 0.35)",yellow:"rgba(234, 179, 8, 0.35)",purple:"rgba(168, 85, 247, 0.35)"};l.fillStyle=o[n]||o.red,l.fillRect(t,a,r,s),l.strokeStyle="red"===n?"#DC2626":"blue"===n?"#3B82F6":"green"===n?"#22C55E":"yellow"===n?"#EAB308":"#A855F7",l.lineWidth=Math.max(1,i/500),l.strokeRect(t,a,r,s)}}),l.restore());let h=t.toDataURL("image/webp",.85);b(t=>new Map([...t,[e,{url:h,hash:r}]]))}}catch(t){console.warn("缩略图渲染失败 (第".concat(e,"页):"),t)}finally{w(t=>{let a=new Set(t);return a.delete(e),a}),N.current.delete(e)}}},[t,a,n,g,x,R,p]),S=(0,s.useCallback)(()=>{t&&0!==o&&(M(i),requestAnimationFrame(()=>{let e=Math.max(1,i-2),t=Math.min(o,i+2);for(let a=e;a<=t;a++)a!==i&&setTimeout(()=>M(a),(Math.abs(a-i)-1)*50)}))},[t,o,i,M]);(0,s.useEffect)(()=>{S()},[S]);let E=(0,s.useCallback)(()=>{if(p.size>20){let e=Array.from(p.entries()).sort((e,t)=>{let a=Math.abs(e[0]-i);return Math.abs(t[0]-i)-a}).slice(20),t=new Map(p);e.forEach(e=>{let[a]=e,r=t.get(a);(null==r?void 0:r.url.startsWith("blob:"))&&URL.revokeObjectURL(r.url),t.delete(a)}),b(t)}},[p,i,20]);(0,s.useEffect)(()=>()=>{p.forEach(e=>{e.url.startsWith("blob:")&&URL.revokeObjectURL(e.url)})},[]),(0,s.useEffect)(()=>{let e=setTimeout(E,5e3);return()=>clearTimeout(e)},[p.size,E]);let D=(0,s.useCallback)(()=>{if(!t)return;let e=[];for(let t=1;t<=o;t++){let a=R(t),r=p.get(t);r&&r.hash===a||e.push(t)}e.forEach((e,t)=>{setTimeout(()=>M(e),30*t)})},[t,o,R,p,M]);(0,s.useEffect)(()=>{D()},[D]),(0,s.useEffect)(()=>{},[x]),(0,s.useEffect)(()=>{if(v.current&&y.current){let e=setTimeout(()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100);return()=>clearTimeout(e)}},[i]);let F=(0,s.useCallback)(e=>{console.log("点击缩略图页面 ".concat(e)),c(e)},[c]);return t?(0,r.jsxs)("div",{className:"flex flex-col h-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-white border-b border-gray-200 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4 text-gray-600"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-900",children:u("view.thumbnailView")}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["(",u("pdf.thumbnailViewPages",{total:o}),")"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("button",{onClick:()=>m(e=>Math.max(e-.2,.6)),className:"p-1.5 rounded-md hover:bg-gray-100 transition-colors",title:u("view.zoomOut"),children:(0,r.jsx)(k.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"px-2 py-1 text-xs font-medium bg-gray-50 rounded-md min-w-[50px] text-center",children:[Math.round(100*x),"%"]}),(0,r.jsx)("button",{onClick:()=>m(e=>Math.min(e+.2,2)),className:"p-1.5 rounded-md hover:bg-gray-100 transition-colors",title:u("view.zoomIn"),children:(0,r.jsx)(C.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>m(1.2),className:"p-1.5 rounded-md hover:bg-gray-100 transition-colors",title:u("view.resetZoom"),children:(0,r.jsx)(P.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsx)("div",{ref:y,className:"flex-1 overflow-auto p-4 scroll-smooth",children:(0,r.jsx)("div",{className:"grid gap-4 transition-all duration-200 ease-out",style:{gridTemplateColumns:"repeat(auto-fill, minmax(".concat(Math.max(120*x,80),"px, 1fr))")},children:Array.from({length:o},(e,t)=>t+1).map(e=>{let t=e===i,a=p.get(e),s=null==a?void 0:a.url,l=f.has(e),o=n[e-1]||[];return(0,r.jsx)("div",{ref:t?v:null,className:"relative cursor-pointer group transition-all duration-300 ease-out ".concat(t?"transform scale-105 z-10":"hover:scale-105 hover:z-20"),onClick:()=>F(e),children:(0,r.jsxs)("div",{className:"bg-white rounded-lg overflow-hidden border-2 transition-all duration-300 ".concat(t?"border-blue-500 shadow-xl":"border-gray-200 group-hover:border-blue-300 group-hover:shadow-lg"),children:[(0,r.jsxs)("div",{className:"aspect-[3/4] bg-gray-100 flex items-center justify-center relative",style:{minHeight:"".concat(Math.max(120*x,80),"px"),height:"".concat(Math.max(160*x,100),"px")},children:[s?(0,r.jsx)("img",{src:s,alt:u("pdf.page",{number:e}),className:"w-full h-full object-contain transition-opacity duration-300",loading:"lazy",onLoad:e=>{e.target.style.opacity="1"},style:{opacity:0}}):l?(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:u("common.loading")})]}):(0,r.jsxs)("div",{className:"text-center text-gray-400",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded mb-2 mx-auto animate-pulse"}),(0,r.jsx)("span",{className:"text-xs",children:u("thumbnail.waitingLoad")})]}),o.length>0&&(0,r.jsx)("div",{className:"absolute top-1 right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-medium",children:o.length})]}),(0,r.jsxs)("div",{className:"p-2 text-center",children:[(0,r.jsx)("div",{className:"text-sm font-medium transition-colors duration-200 ".concat(t?"text-blue-700":"text-gray-700"),children:u("pdf.page",{number:e})}),o.length>0&&(0,r.jsx)("div",{className:"text-xs text-red-600 mt-1",children:u("pdf.marks",{count:o.length})})]})]})},e)})})})]}):null},Z=e=>{let{pageNumber:t,scale:a,onRenderPage:n,rects:i,onAddRect:o,onUpdateRect:c,onRemoveRect:d,selectedRectId:h,onSelectRect:g,previewMode:u,isPanMode:x,redactionMethod:m="canvas"}=e,{t:p}=(0,l.$G)(),b=(0,s.useRef)(null),f=(0,s.useRef)(null),w=(0,s.useRef)(null),[y,v]=(0,s.useState)(!1),[j,N]=(0,s.useState)(null),[k,C]=(0,s.useState)(null),[P,R]=(0,s.useState)(!1),[M,S]=(0,s.useState)(null),[E,D]=(0,s.useState)(null),F=(0,s.useRef)(null),Z=(0,s.useRef)(!1),z=(0,s.useRef)(!1),U=(0,s.useRef)(null),T=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&v(!0)})},{rootMargin:"200px"});return b.current&&e.observe(b.current),()=>e.disconnect()},[]);let W=(0,s.useCallback)(()=>{let e=w.current,t=f.current;if(!e)return;let a=e.getContext("2d");if(!a)return;a.clearRect(0,0,e.width,e.height),a.save();let r=window.devicePixelRatio||1,s=e.width/r,l=e.height/r;if(a.scale(r,r),i.forEach((e,n)=>{let i=(Z.current||z.current)&&h===e.id&&F.current?F.current:e,o=i.x/i.pageWidth*s,c=i.y/i.pageHeight*l,d=i.width/i.pageWidth*s,g=i.height/i.pageHeight*l;if(u){if("pixelate"===m&&t)try{let e=Math.floor(o*r),s=Math.floor(c*r),l=Math.ceil(d*r),n=Math.ceil(g*r),i=t.getContext("2d");if(i){let t=i.getImageData(e,s,l,n),o=8*r;for(let e=0;e<n;e+=o)for(let a=0;a<l;a+=o){let r=0,s=0,i=0,c=0;for(let d=0;d<o&&e+d<n;d++)for(let n=0;n<o&&a+n<l;n++){let o=((e+d)*l+(a+n))*4;o+2<t.data.length&&(r+=t.data[o],s+=t.data[o+1],i+=t.data[o+2],c++)}if(c>0){r=Math.floor(r/c),s=Math.floor(s/c),i=Math.floor(i/c);let d=Math.min(o,l-a),h=Math.min(o,n-e);for(let n=0;n<h;n++)for(let o=0;o<d;o++){let c=((e+n)*l+(a+o))*4;t.data[c]=r,t.data[c+1]=s,t.data[c+2]=i,t.data[c+3]=255}}}a.putImageData(t,e,s)}else throw Error("No main context")}catch(e){console.warn("Pixelate preview failed, falling back to black",e),a.fillStyle="#000000",a.fillRect(o,c,d,g)}else a.fillStyle="#000000",a.fillRect(o,c,d,g)}else{let t=h===e.id,s=i.color||"red",l={red:{fill:"rgba(239, 68, 68, 0.2)",stroke:"#DC2626"},blue:{fill:"rgba(59, 130, 246, 0.2)",stroke:"#3B82F6"},green:{fill:"rgba(34, 197, 94, 0.2)",stroke:"#22C55E"},yellow:{fill:"rgba(234, 179, 8, 0.2)",stroke:"#EAB308"},purple:{fill:"rgba(168, 85, 247, 0.2)",stroke:"#A855F7"}},u=l[s]||l.red;if(a.fillStyle=t?u.fill.replace("0.2","0.35"):u.fill,a.strokeStyle=u.stroke,a.lineWidth=t?3/r:2/r,a.setLineDash(t?[]:[4/r,4/r]),a.fillRect(o,c,d,g),a.strokeRect(o,c,d,g),a.setLineDash([]),a.fillStyle=u.stroke,a.font="".concat(12/r,"px sans-serif"),a.fillText("".concat(n+1),o+4/r,c+16/r),t){let e=8/r;a.fillStyle=u.stroke,a.strokeStyle="#ffffff",a.lineWidth=2/r,[{x:o-e/2,y:c-e/2},{x:o+d-e/2,y:c-e/2},{x:o-e/2,y:c+g-e/2},{x:o+d-e/2,y:c+g-e/2}].forEach(t=>{a.fillRect(t.x,t.y,e,e),a.strokeRect(t.x,t.y,e,e)})}}}),P&&F.current){let e=F.current,t=e.x,s=e.y;a.setLineDash([2/r,2/r]),a.fillStyle="rgba(59, 130, 246, 0.2)",a.strokeStyle="#3B82F6",a.lineWidth=2/r,a.fillRect(t,s,e.width,e.height),a.strokeRect(t,s,e.width,e.height)}a.restore()},[i,h,u,P,m]);(0,s.useEffect)(()=>{y&&(async()=>{try{C(null);let r=await n(t,a);if(r.success&&r.imageData){let t=f.current,a=w.current;if(!t||!a)return;let s=t.getContext("2d",{alpha:!1,desynchronized:!0});if(!s)return;let l=window.devicePixelRatio||1,n=r.width*l,i=r.height*l;if((t.width!==n||t.height!==i)&&(t.width=n,t.height=i,a.width=n,a.height=i,t.style.width="".concat(r.width,"px"),t.style.height="".concat(r.height,"px"),a.style.width="".concat(r.width,"px"),a.style.height="".concat(r.height,"px"),N({width:r.width,height:r.height})),s.scale(l,l),1!==l){var e;let t=document.createElement("canvas");t.width=r.width,t.height=r.height,null===(e=t.getContext("2d"))||void 0===e||e.putImageData(r.imageData,0,0),s.drawImage(t,0,0)}else s.putImageData(r.imageData,0,0);requestAnimationFrame(W)}else C(r.error||"Failed to render page")}catch(e){console.error("Error rendering page ".concat(t,":"),e),C(e.message||"Unknown error")}})()},[y,t,a,n,W]);let _=(0,s.useCallback)(e=>{if(!w.current)return null;let t=w.current.getBoundingClientRect(),a=window.devicePixelRatio||1,r=w.current.width/a/t.width,s=w.current.height/a/t.height;return{x:(e.clientX-t.left)*r,y:(e.clientY-t.top)*s}},[]),L=(0,s.useCallback)((e,t,a)=>{let r=a.width/t.pageWidth,s=a.height/t.pageHeight,l=t.x*r,n=t.y*s,i=t.width*r,o=t.height*s;return 10>Math.abs(e.x-l)&&10>Math.abs(e.y-n)?"nw":10>Math.abs(e.x-(l+i))&&10>Math.abs(e.y-n)?"ne":10>Math.abs(e.x-l)&&10>Math.abs(e.y-(n+o))?"sw":10>Math.abs(e.x-(l+i))&&10>Math.abs(e.y-(n+o))?"se":null},[]),B=(0,s.useCallback)(e=>{if(x||u||!w.current)return;let t=_(e);if(!t)return;let a=w.current;for(let r=i.length-1;r>=0;r--){let s=i[r],l=a.width/s.pageWidth,n=a.height/s.pageHeight,o=s.x*l,c=s.y*n,d=s.width*l,u=s.height*n;if(h===s.id){let r=L(t,s,a);if(r){z.current=!0,D(r),U.current=t,T.current={...s},e.stopPropagation();return}}if(t.x>=o&&t.x<=o+d&&t.y>=c&&t.y<=c+u){g(s.id),Z.current=!0,U.current=t,T.current={...s},W(),e.stopPropagation();return}}g(null),R(!0),S(t),F.current={x:t.x,y:t.y,width:0,height:0,pageWidth:a.width,pageHeight:a.height,id:"temp"}},[x,u,_,i,h,L,g,W]),A=(0,s.useCallback)(e=>{if(u||!w.current)return;let t=_(e);if(!t)return;let a=w.current;if(Z.current&&U.current&&T.current){let e=t.x-U.current.x,r=t.y-U.current.y,s=T.current.pageWidth/a.width,l=T.current.pageHeight/a.height;F.current={...T.current,x:T.current.x+e*s,y:T.current.y+r*l},requestAnimationFrame(W);return}if(z.current&&U.current&&T.current&&E){let e=(t.x-U.current.x)*(T.current.pageWidth/a.width),r=(t.y-U.current.y)*(T.current.pageHeight/a.height),s={...T.current};E.includes("e")&&(s.width+=e),E.includes("w")&&(s.x+=e,s.width-=e),E.includes("s")&&(s.height+=r),E.includes("n")&&(s.y+=r,s.height-=r),s.width<0&&(s.x+=s.width,s.width=Math.abs(s.width)),s.height<0&&(s.y+=s.height,s.height=Math.abs(s.height)),F.current=s,requestAnimationFrame(W);return}if(P&&M){let e=t.x-M.x,r=t.y-M.y;F.current={x:e<0?t.x:M.x,y:r<0?t.y:M.y,width:Math.abs(e),height:Math.abs(r),pageWidth:a.width,pageHeight:a.height,id:"temp"},requestAnimationFrame(W)}},[u,_,P,M,E,W]),H=(0,s.useCallback)(()=>{P&&F.current&&F.current.width>5&&F.current.height>5?o({...F.current,id:"rect-".concat(Date.now())}):(Z.current||z.current)&&F.current&&c(F.current),R(!1),Z.current=!1,z.current=!1,S(null),F.current=null,U.current=null,T.current=null,D(null),requestAnimationFrame(W)},[P,o,c,W]);return(0,s.useEffect)(()=>{W()},[i,h,W]),(0,r.jsxs)("div",{ref:b,className:"relative shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)] border border-gray-200 bg-white mb-8",style:{width:j?j.width:"auto",height:j?j.height:"500px",minHeight:"200px"},children:[(0,r.jsx)("div",{className:"absolute top-0 left-0 bg-gray-100 text-gray-500 text-xs px-2 py-1 rounded-br z-10",children:p("pdf.page",{number:t})}),!y&&(0,r.jsxs)("div",{className:"flex items-center justify-center w-full h-full text-gray-400",children:["Loading Page ",t,"..."]}),(0,r.jsx)("canvas",{ref:f,className:"block"}),(0,r.jsx)("canvas",{ref:w,className:"absolute top-0 left-0 ".concat(x?"cursor-grab active:cursor-grabbing":"cursor-crosshair"),onMouseDown:B,onMouseMove:A,onMouseUp:H,onMouseLeave:H,onDoubleClick:e=>{if(u||!w.current)return;let t=_(e);if(!t)return;let a=w.current;for(let e of i){let r=a.width/e.pageWidth,s=a.height/e.pageHeight,l=e.x*r,n=e.y*s,i=e.width*r,o=e.height*s;if(t.x>=l&&t.x<=l+i&&t.y>=n&&t.y<=n+o){d(e.id),g(null);return}}}})]})},z=e=>{let{file:t,onRenderPage:a,redactionRects:n,onAddRedactionRect:i,onRemoveRedactionRect:o,setRedactionRects:c,currentPage:d,totalPages:h,onPageChange:g,loading:u=!1,previewMode:x=!1,redactionMethod:m="canvas"}=e,{t:p}=(0,l.$G)(),b=(0,s.useRef)(null),[f,w]=(0,s.useState)(1.2),[S,E]=(0,s.useState)(!1),[z,U]=(0,s.useState)("single"),[T,W]=(0,s.useState)(null),_=(0,s.useRef)([]);(0,s.useEffect)(()=>{_.current=_.current.slice(0,h)},[h]);let L=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(L.current)return;let e=_.current[d-1];if(e&&b.current){let t=b.current,a=e.getBoundingClientRect(),r=t.getBoundingClientRect();a.top>=r.top&&a.bottom<=r.bottom||e.scrollIntoView({behavior:"auto",block:"start"})}},[d,h,z]);let B=(0,s.useRef)(null),A=(0,s.useCallback)(()=>{if(!b.current||"single"!==z)return;L.current=!0,B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{L.current=!1},150);let e=b.current.getBoundingClientRect(),t=e.top+e.height/2,a=d,r=1/0;_.current.forEach((s,l)=>{if(!s)return;let n=s.getBoundingClientRect();if(n.bottom<e.top-500||n.top>e.bottom+500)return;let i=Math.abs(n.top+n.height/2-t);i<r&&(r=i,a=l+1)}),a!==d&&g(a)},[d,g,z]),H=(0,s.useCallback)(()=>w(e=>Math.min(1.25*e,4)),[]),I=(0,s.useCallback)(()=>w(e=>Math.max(e/1.25,.3)),[]),O=(0,s.useCallback)(()=>w(1.2),[]),G=(0,s.useCallback)(()=>{b.current&&w((b.current.clientWidth-48)/800)},[]),$=(0,s.useCallback)((e,t)=>{i(e,t),W(t.id)},[i]),q=(0,s.useCallback)((e,t)=>{c(a=>{let r=[...a],s=e-1;if(r[s]){let e=r[s].findIndex(e=>e.id===t.id);-1!==e&&(r[s][e]=t)}return r})},[c]),J=(0,s.useCallback)((e,t)=>{o(e,t),T===t&&W(null)},[o,T]);return t?(0,r.jsxs)("div",{className:"flex flex-col h-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-white border-b-2 border-black shadow-sm shrink-0 z-10 relative",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>g(Math.max(1,d-1)),disabled:d<=1,className:"neo-btn-sm bg-white hover:bg-gray-100 disabled:opacity-50",children:(0,r.jsx)(y.Z,{className:"w-4 h-4"})}),(0,r.jsx)(D,{currentPage:d,totalPages:h,onPageChange:e=>{g(e),L.current=!1}}),(0,r.jsx)("button",{onClick:()=>g(Math.min(h,d+1)),disabled:d>=h,className:"neo-btn-sm bg-white hover:bg-gray-100 disabled:opacity-50",children:(0,r.jsx)(v.Z,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>U(e=>"single"===e?"thumbnail":"single"),className:"neo-btn-sm bg-white hover:bg-gray-100",children:"single"===z?(0,r.jsx)(j.Z,{className:"w-4 h-4"}):(0,r.jsx)(N.Z,{className:"w-4 h-4"})}),"single"===z&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:I,className:"neo-btn-sm bg-white hover:bg-gray-100",children:(0,r.jsx)(k.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("span",{className:"text-sm font-bold w-12 text-center",children:[Math.round(100*f),"%"]}),(0,r.jsx)("button",{onClick:H,className:"neo-btn-sm bg-white hover:bg-gray-100",children:(0,r.jsx)(C.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:O,className:"neo-btn-sm bg-white hover:bg-gray-100 hidden sm:flex",children:(0,r.jsx)(P.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:G,className:"neo-btn-sm bg-white hover:bg-gray-100 hidden sm:flex",children:(0,r.jsx)(R.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>E(!S),className:"neo-btn-sm ".concat(S?"bg-black text-white":"bg-white hover:bg-gray-100"," hidden sm:flex"),children:(0,r.jsx)(M.Z,{className:"w-4 h-4"})})]})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden relative bg-gray-100",children:(0,r.jsx)("div",{ref:b,className:"absolute inset-0 overflow-auto flex flex-col items-center py-8 px-4",onScroll:A,children:"single"===z?(0,r.jsx)("div",{className:"flex flex-col gap-8",children:Array.from({length:h},(e,t)=>t+1).map(e=>(0,r.jsx)("div",{ref:t=>{_.current[e-1]=t},children:(0,r.jsx)(Z,{pageNumber:e,scale:f,onRenderPage:a,rects:n[e-1]||[],onAddRect:t=>$(e,t),onUpdateRect:t=>q(e,t),onRemoveRect:t=>J(e,t),selectedRectId:T,onSelectRect:W,previewMode:x,isPanMode:S,redactionMethod:m})},e))}):(0,r.jsx)(F,{file:t,onRenderPage:a,redactionRects:n,currentPage:d,totalPages:h,onPageChange:e=>{g(e),U("single")},loading:u})})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-50",children:(0,r.jsx)("p",{className:"text-gray-500 font-bold",children:p("pdf.loading")})})};var U=a(8124),T=a(8728),W=a(2805),_=a(4064),L=a(8477),B=a(2208),A=a(2735),H=a(8930);let I=e=>{let{redactionMethod:t,onMethodChange:a,onProcess:s,onClear:n,onPreview:i,onUndo:o,onRedo:c,processing:h,hasRedactions:g,canUndo:u,canRedo:x,selectedColor:m="red",onColorChange:p}=e,{t:b}=(0,l.$G)(),f=[{id:"canvas",name:b("toolbar.methods.canvas"),description:b("toolbar.methods.canvasDesc"),icon:U.Z,recommended:!0,color:"blue"}],w=[{id:"red",name:b("toolbar.colors.red"),value:"#ef4444",bgClass:"bg-red-500"},{id:"blue",name:b("toolbar.colors.blue"),value:"#3b82f6",bgClass:"bg-blue-500"},{id:"green",name:b("toolbar.colors.green"),value:"#22c55e",bgClass:"bg-green-500"},{id:"yellow",name:b("toolbar.colors.yellow"),value:"#eab308",bgClass:"bg-yellow-500"},{id:"purple",name:b("toolbar.colors.purple"),value:"#a855f7",bgClass:"bg-purple-500"}];return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-white",children:[(0,r.jsx)("div",{className:"p-4 border-b-2 border-black bg-yellow-50",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(T.Z,{className:"w-5 h-5 text-black mr-2"}),(0,r.jsx)("h3",{className:"text-base font-black text-black uppercase",children:b("toolbar.title")})]})}),(0,r.jsxs)("div",{className:"p-4 border-b-2 border-black",children:[(0,r.jsx)("h4",{className:"text-sm font-bold text-black mb-3 uppercase tracking-wide",children:b("toolbar.methodTitle")}),(0,r.jsx)("div",{className:"space-y-3",children:f.map(e=>{let s=e.icon,l=t===e.id;return(0,r.jsxs)("label",{className:"\n                  relative flex items-start p-3 border-2 cursor-pointer transition-all duration-200\n                  ".concat(l?"border-black bg-blue-100 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]":"border-black hover:bg-gray-50","\n                "),children:[(0,r.jsx)("input",{type:"radio",name:"redactionMethod",value:e.id,checked:l,onChange:()=>a(e.id),className:"sr-only"}),(0,r.jsx)("div",{className:"flex-shrink-0 mr-3 mt-1",children:(0,r.jsx)(s,{className:"w-5 h-5 ".concat(l?"text-black":"text-gray-500")})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-sm font-bold text-black",children:e.name}),e.recommended&&(0,r.jsx)("span",{className:"ml-2 px-1.5 py-0.5 text-[10px] font-black uppercase bg-green-400 text-black border border-black",children:b("toolbar.recommended")})]}),(0,r.jsx)("p",{className:"text-xs mt-1 text-gray-700 font-medium",children:e.description})]})]},e.id)})})]}),p&&(0,r.jsxs)("div",{className:"p-4 border-b-2 border-black",children:[(0,r.jsxs)("h4",{className:"text-sm font-bold text-black mb-3 flex items-center uppercase tracking-wide",children:[(0,r.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),b("toolbar.markColor")]}),(0,r.jsx)("div",{className:"grid grid-cols-5 gap-2",children:w.map(e=>(0,r.jsx)("button",{onClick:()=>p(e.id),className:"\n                  relative w-10 h-10 border-2 transition-all duration-200\n                  ".concat(m===e.id?"border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] scale-110 z-10":"border-black hover:scale-105","\n                "),title:e.name,children:(0,r.jsx)("div",{className:"w-full h-full ".concat(e.bgClass)})},e.id))})]}),(0,r.jsxs)("div",{className:"p-4 space-y-3 flex-1 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("button",{onClick:o,disabled:!u||h,className:"flex-1 neo-btn-sm bg-white hover:bg-gray-100 flex justify-center items-center disabled:opacity-50",title:b("toolbar.undoTooltip"),children:[(0,r.jsx)(_.Z,{className:"w-4 h-4 mr-1"}),b("toolbar.undo")]}),(0,r.jsxs)("button",{onClick:c,disabled:!x||h,className:"flex-1 neo-btn-sm bg-white hover:bg-gray-100 flex justify-center items-center disabled:opacity-50",title:b("toolbar.redoTooltip"),children:[(0,r.jsx)(L.Z,{className:"w-4 h-4 mr-1"}),b("toolbar.redo")]})]}),(0,r.jsxs)("button",{onClick:i,disabled:!g||h,className:"w-full neo-btn bg-white hover:bg-yellow-200 flex justify-center items-center disabled:opacity-50 disabled:shadow-none disabled:translate-x-1 disabled:translate-y-1",children:[(0,r.jsx)(B.Z,{className:"w-4 h-4 mr-2"}),b("toolbar.preview")]}),(0,r.jsx)("button",{onClick:s,disabled:!g||h,className:"w-full neo-btn bg-blue-600 text-white hover:bg-blue-500 flex justify-center items-center disabled:opacity-50 disabled:shadow-none disabled:translate-x-1 disabled:translate-y-1",children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full"}),b("toolbar.processing")]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.Z,{className:"w-4 h-4 mr-2"}),b("toolbar.generatePDF")]})}),(0,r.jsxs)("button",{onClick:n,disabled:!g||h,className:"w-full neo-btn bg-red-500 text-white hover:bg-red-400 flex justify-center items-center disabled:opacity-50 disabled:shadow-none disabled:translate-x-1 disabled:translate-y-1",children:[(0,r.jsx)(H.Z,{className:"w-4 h-4 mr-2"}),b("toolbar.clearMarks")]})]}),(0,r.jsx)("div",{className:"p-4 border-t-2 border-black bg-blue-50",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 text-black flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{className:"ml-2",children:[(0,r.jsx)("h5",{className:"text-xs font-black text-black uppercase mb-1",children:"Local Processing"}),(0,r.jsx)("p",{className:"text-xs text-gray-800 font-medium leading-relaxed",children:"Files never leave your device."})]})]})})]})};var O=a(7781),G=a(9067);O.Tu.workerSrc="/pdf.worker.mjs";var $=a(4590);function q(){let{t:e}=(0,l.$G)(),[t,a]=(0,s.useState)("upload"),[u,x]=(0,s.useState)(null),[m,p]=(0,s.useState)(0),[b,f]=(0,s.useState)(1),[y,v]=(0,s.useState)([]),[j,N]=(0,s.useState)([]),[k,C]=(0,s.useState)(-1),[P,R]=(0,s.useState)("canvas"),[M,S]=(0,s.useState)(!1),[E,D]=(0,s.useState)(""),[F,Z]=(0,s.useState)(""),[U,T]=(0,s.useState)(!1),[W,_]=(0,s.useState)("red"),{loadPDF:L,renderPage:B,processRedaction:A,loading:H,progress:q,isWorkerReady:J}=function(){let{t:e}=(0,l.$G)(),[t,a]=(0,s.useState)(!1),[r,n]=(0,s.useState)(null),i=(0,s.useRef)(null),o=(0,s.useRef)(null),c=(0,s.useRef)({}),d=(0,s.useRef)(new Map),h=(0,s.useCallback)((e,t,a,r,s)=>{n({stage:e,progress:t,message:a,currentPage:r,totalPages:s})},[]),g=(0,s.useCallback)(()=>{let e=Date.now();Object.keys(c.current).forEach(t=>{e-c.current[t].timestamp>3e5&&delete c.current[t]})},[]),u=(0,s.useCallback)(async t=>{a(!0),h("loading",0,e("progress.loadingStart")),c.current={};try{h("loading",20,e("progress.readingFile"));let a=await t.arrayBuffer(),r=a.slice(0);o.current=r,h("loading",50,e("progress.parsingPdf"));let s=O.i8,l=O.Me({data:a,cMapUrl:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(s,"/cmaps/"),cMapPacked:!0,disableFontFace:!1,useSystemFonts:!0,disableStream:!0,disableAutoFetch:!0,disableRange:!0,maxImageSize:31457280,verbosity:0,stopAtErrors:!1,isEvalSupported:!1});h("loading",80,e("progress.loadingContent"));let c=await l.promise;return i.current=c,h("loading",100,e("progress.pdfLoaded",{totalPages:c.numPages})),setTimeout(()=>n(null),1e3),{success:!0,numPages:c.numPages,message:e("progress.pdfLoaded",{totalPages:c.numPages})}}catch(a){console.error("PDF loading detailed error:",a);let t=e("error.pdfLoadFailed");return"InvalidPDFException"===a.name?t=e("error.invalidPdf"):"MissingPDFException"===a.name?t=e("error.missingPdf"):"PasswordException"===a.name?t=e("error.passwordProtected"):a.message&&(t=e("error.pdfProcessingError",{message:a.message})),n(null),{success:!1,error:t,message:e("error.pdfLoadFailedGeneric")}}finally{a(!1)}},[h]),x=(0,s.useCallback)(async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5;if(!i.current)throw Error(e("error.pdfNotLoaded"));let s="page-".concat(t,"-scale-").concat(r.toFixed(2));if(c.current[s]){let e=c.current[s];return{success:!0,imageData:e.imageData,width:e.canvas.width,height:e.canvas.height,scale:r}}if(d.current.has(s))return d.current.get(s);0===d.current.size&&a(!0);let l=(async()=>{try{let a=await i.current.getPage(t),l=a.getViewport({scale:r}),n=document.createElement("canvas"),o=n.getContext("2d",{alpha:!1,willReadFrequently:!1,desynchronized:!0});if(!o)throw Error(e("error.cannotGetCanvasContext"));n.width=Math.floor(l.width),n.height=Math.floor(l.height),o.fillStyle="#ffffff",o.fillRect(0,0,n.width,n.height);let d=a.render({canvasContext:o,viewport:l,intent:"display",renderInteractiveForms:!1,includeAnnotationStorage:!1,enableWebGL:!0});await d.promise;let h=o.getImageData(0,0,n.width,n.height);return c.current[s]={canvas:n,imageData:h,timestamp:Date.now()},g(),{success:!0,imageData:h,width:n.width,height:n.height,scale:r}}catch(r){console.error("Page ".concat(t," rendering error:"),r);let a=e("error.pageRenderFailed");return r.message&&(a=e("error.renderError",{message:r.message})),{success:!1,error:a}}finally{0===d.current.size&&a(!1),d.current.delete(s)}})();return d.current.set(s,l),l},[h,g]),m=(0,s.useCallback)(async function(t,r){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";if(!i.current||!o.current)throw Error(e("error.pdfNotLoaded"));a(!0);try{let t=i.current,a=t.numPages,l=r.reduce((e,t)=>e+t.length,0);if(h("processing",0,e("progress.processingStart"),0,a),"canvas"===s)return await p(t,r,a,l);if("pixelate"===s)return await b(t,r,a,l);throw Error(e("error.unsupportedMethod",{method:s}))}catch(t){return console.error("PDF processing error:",t),n(null),{success:!1,error:t.message||e("error.pdfProcessFailed")}}finally{a(!1)}},[h]),p=(0,s.useCallback)(async(t,a,r,s)=>{let l=await G.PDFDocument.create();h("processing",5,e("progress.creatingDocument"),0,r);for(let s=1;s<=r;s++)try{let n=(s-1)/r*80+10;h("processing",n,e("progress.canvasProcessing",{pageNum:s}),s,r);let i=await t.getPage(s),o=i.getViewport({scale:2}),c=document.createElement("canvas"),d=c.getContext("2d",{alpha:!1,willReadFrequently:!1,desynchronized:!0});if(!d){console.warn("Skipping page ".concat(s,": Unable to get Canvas context"));continue}c.width=Math.floor(o.width),c.height=Math.floor(o.height),h("processing",n+2,e("progress.renderingCanvas",{pageNum:s}),s,r);let g={canvasContext:d,viewport:o,intent:"display",enableWebGL:!0},u=i.render(g);await u.promise;let x=a[s-1]||[];x.length>0&&(h("processing",n+4,e("progress.redactingAreas",{count:x.length}),s,r),d.save(),d.fillStyle="#000000",d.globalCompositeOperation="source-over",x.forEach(e=>{let t=Math.floor(e.x/e.pageWidth*c.width),a=Math.floor(e.y/e.pageHeight*c.height),r=Math.ceil(e.width/e.pageWidth*c.width),s=Math.ceil(e.height/e.pageHeight*c.height);d.fillRect(t,a,r,s)}),d.restore()),h("processing",n+6,e("progress.convertingToImage",{pageNum:s}),s,r);let m=await new Promise((e,t)=>{c.toBlob(a=>{a?e(a):t(Error("Canvas to Blob failed"))},"image/jpeg",.95)}),p=await m.arrayBuffer(),b=await l.embedJpg(p);l.addPage([c.width,c.height]).drawImage(b,{x:0,y:0,width:c.width,height:c.height})}catch(t){console.warn("Error processing page ".concat(s,":"),t),h("processing",(s-1)/r*80+10,e("progress.pageError",{pageNum:s}),s,r)}h("finalizing",90,e("progress.generatingFinalPdf"));let i=await l.save();return h("finalizing",100,e("progress.canvasCompleted",{totalPages:r,marksCount:s})),setTimeout(()=>n(null),2e3),{success:!0,pdfBytes:i,message:e("progress.canvasComplete",{totalPages:r,marksCount:s})}},[h]),b=(0,s.useCallback)(async(t,a,r,s)=>{let l=await G.PDFDocument.create();h("processing",5,e("progress.rebuildPrep"),0,r);for(let s=1;s<=r;s++)try{let n=(s-1)/r*80+10;h("processing",n,e("progress.pixelateProcessing",{pageNum:s}),s,r);let i=await t.getPage(s),o=i.getViewport({scale:1.5}),c=document.createElement("canvas"),d=c.getContext("2d");if(!d){console.warn("Skipping page ".concat(s,": Unable to get Canvas context"));continue}c.width=Math.floor(o.width),c.height=Math.floor(o.height);let g={canvasContext:d,viewport:o,intent:"display"},u=i.render(g);await u.promise;let x=a[s-1]||[];x.length>0&&(h("processing",n+4,e("progress.pixelateAreas",{count:x.length}),s,r),x.forEach(e=>{let t=Math.floor(e.x/e.pageWidth*c.width),a=Math.floor(e.y/e.pageHeight*c.height),r=Math.ceil(e.width/e.pageWidth*c.width),s=Math.ceil(e.height/e.pageHeight*c.height),l=d.getImageData(t,a,r,s);for(let e=0;e<s;e+=8)for(let n=0;n<r;n+=8){let i=0,o=0,c=0,h=0;for(let t=0;t<8&&e+t<s;t++)for(let a=0;a<8&&n+a<r;a++){let s=((e+t)*r+(n+a))*4;s+2<l.data.length&&(i+=l.data[s],o+=l.data[s+1],c+=l.data[s+2],h++)}h>0&&(i=Math.floor(i/h),o=Math.floor(o/h),c=Math.floor(c/h),d.fillStyle="rgb(".concat(i,", ").concat(o,", ").concat(c,")"),d.fillRect(t+n,a+e,Math.min(8,r-n),Math.min(8,s-e)))}})),h("processing",n+6,e("progress.convertingToImage",{pageNum:s}),s,r);let m=await new Promise((e,t)=>{c.toBlob(a=>{a?e(a):t(Error("Canvas to Blob failed"))},"image/jpeg",.9)}),p=await m.arrayBuffer(),b=await l.embedJpg(p);l.addPage([c.width,c.height]).drawImage(b,{x:0,y:0,width:c.width,height:c.height})}catch(t){console.warn("Error processing page ".concat(s,":"),t),h("processing",(s-1)/r*80+10,e("progress.pageError",{pageNum:s}),s,r)}h("finalizing",90,e("progress.generatingFinalPdf"));let i=await l.save();return h("finalizing",100,e("progress.pixelateCompleted",{totalPages:r,marksCount:s})),setTimeout(()=>n(null),2e3),{success:!0,pdfBytes:i,message:e("progress.pixelateCompleted",{totalPages:r,marksCount:s})}},[h]);return{loadPDF:u,renderPage:x,processRedaction:m,processWithCanvas:p,processWithPixelate:b,processWithRebuild:(0,s.useCallback)(async(t,a,r,s)=>{if(h("processing",5,e("progress.rebuildPrep"),0,r),!o.current)throw Error(e("error.pdfDataNotFound"));let l=await G.PDFDocument.load(o.current),i=await G.PDFDocument.create();h("processing",10,e("progress.analyzingStructure"),0,r);for(let s=1;s<=r;s++)try{let n=(s-1)/r*80+15;if(h("processing",n,e("progress.processingStructure",{pageNum:s}),s,r),!l.getPages()[s-1]){console.warn("Page ".concat(s," does not exist, skipping..."));continue}let[o]=await i.copyPages(l,[s-1]),c=i.addPage(o),d=a[s-1]||[];if(d.length>0){h("processing",n+4,e("progress.removingText",{pageNum:s,count:d.length}),s,r);let{width:a,height:l}=c.getSize();try{let i=await t.getPage(s),o=await i.getTextContent(),g=[];o.items.forEach((e,t)=>{if(e.str&&e.transform){let r=e.transform[4],s=l-e.transform[5],n=e.width||0,i=e.height||12;d.some(e=>{let t=e.x/e.pageWidth*a,o=e.y/e.pageHeight*l,c=e.width/e.pageWidth*a,d=e.height/e.pageHeight*l;return r>=t&&r<=t+c&&s>=o&&s<=o+d||r+n>=t&&r+n<=t+c&&s+i>=o&&s+i<=o+d})&&g.push({item:e,index:t})}}),h("processing",n+6,e("progress.addingMasks",{pageNum:s,count:d.length}),s,r),d.forEach(e=>{let t=e.x/e.pageWidth*a,r=l-e.y/e.pageHeight*l-e.height/e.pageHeight*l,s=e.width/e.pageWidth*a,n=e.height/e.pageHeight*l;c.drawRectangle({x:t-1,y:r-1,width:s+2,height:n+2,color:(0,G.rgb)(1,1,1),borderWidth:0}),c.drawRectangle({x:t,y:r,width:s,height:n,color:(0,G.rgb)(0,0,0),borderWidth:0})}),h("processing",n+8,e("progress.structureComplete",{pageNum:s,count:g.length}),s,r)}catch(e){console.warn("Page ".concat(s," text analysis failed, using basic masking method:"),e),d.forEach(e=>{let t=e.x/e.pageWidth*a,r=l-e.y/e.pageHeight*l-e.height/e.pageHeight*l,s=e.width/e.pageWidth*a,n=e.height/e.pageHeight*l;c.drawRectangle({x:t-1,y:r-1,width:s+2,height:n+2,color:(0,G.rgb)(1,1,1),borderWidth:0}),c.drawRectangle({x:t,y:r,width:s,height:n,color:(0,G.rgb)(0,0,0),borderWidth:0})})}}else h("processing",n+8,e("progress.noSensitiveAreas",{pageNum:s}),s,r)}catch(t){console.warn("Error processing page ".concat(s,":"),t),h("processing",(s-1)/r*80+15,e("progress.pageError",{pageNum:s}),s,r)}h("finalizing",95,e("progress.cleaningMetadata"));try{i.setTitle(""),i.setAuthor(""),i.setSubject(""),i.setCreator(e("app.title")),i.setProducer(e("app.title")),i.setCreationDate(new Date),i.setModificationDate(new Date)}catch(e){console.warn("Metadata cleaning failed:",e)}let c=await i.save();return h("finalizing",100,e("progress.rebuildCompleted",{totalPages:r,marksCount:s})),setTimeout(()=>n(null),2e3),{success:!0,pdfBytes:c,message:e("progress.rebuildCompleted",{totalPages:r,marksCount:s})}},[h]),loading:t,progress:r,isWorkerReady:!0}}(),V=(0,s.useCallback)(e=>{let t=j.slice(0,k+1);t.push(JSON.parse(JSON.stringify(e))),t.length>50?t.shift():C(k+1),N(t)},[j,k]),K=(0,s.useCallback)(()=>{if(k>0){let t=k-1;C(t),v(JSON.parse(JSON.stringify(j[t]))),Z(e("action.undoSuccess")),setTimeout(()=>Z(""),2e3)}},[k,j,e]),Q=(0,s.useCallback)(()=>{if(k<j.length-1){let t=k+1;C(t),v(JSON.parse(JSON.stringify(j[t]))),Z(e("action.redoSuccess")),setTimeout(()=>Z(""),2e3)}},[k,j,e]),X=(0,s.useCallback)(()=>{D(""),Z("")},[]),Y=(0,s.useCallback)(async t=>{X();try{if(t.size>52428800){D(e("fileUploader.validation.sizeError"));return}if("application/pdf"!==t.type){D(e("fileUploader.validation.selectValid"));return}x(t),Z(e("fileUploader.loading.description"));let r=await L(t);r.success&&r.numPages?(p(r.numPages),f(1),v(Array(r.numPages).fill(null).map(()=>[])),a("editor"),Z(e("pdf.loading",{totalPages:r.numPages})),setTimeout(()=>Z(""),5e3)):(D(r.error||e("pdf.loadError")),x(null))}catch(t){console.error("File processing error:",t),D(t.message||e("common.processError")),x(null)}},[L,X,e]),ee=(0,s.useCallback)((t,a)=>{let r={...a,color:W};v(e=>{let a=[...e];return a[t-1]||(a[t-1]=[]),a[t-1]=[...a[t-1],r],V(a),a}),Z(e("pdf.markAdded",{pageNum:t})),setTimeout(()=>Z(""),2e3)},[V,W,e]),et=(0,s.useCallback)((t,a)=>{v(e=>{let r=[...e];return r[t-1]&&(r[t-1]=r[t-1].filter(e=>e.id!==a)),V(r),r}),Z(e("pdf.markRemoved",{pageNum:t})),setTimeout(()=>Z(""),2e3)},[V,e]),ea=(0,s.useCallback)(()=>{if(window.confirm(e("toolbar.confirmClearAll"))){let t=Array(m).fill(null).map(()=>[]);v(t),V(t),Z(e("toolbar.clearSuccess")),setTimeout(()=>Z(""),2e3)}},[m,V,e]),er=(0,s.useCallback)(()=>{T(!0)},[]),es=(0,s.useCallback)(async()=>{if(!u){D(e("pdf.noFileError"));return}let t=y.reduce((e,t)=>e+t.length,0);if(0===t){D(e("pdf.noMarksError"));return}if(window.confirm(e("pdf.confirmProcess",{method:e("process.canvas"),count:t}))){S(!0),X(),Z(e("process.processingPdf"));try{let t=await A(u,y,P);if(t.success&&t.pdfBytes){let a=new Blob([t.pdfBytes],{type:"application/pdf"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="".concat(e("common.secureEdit"),"_").concat(u.name),document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(r),1e3),Z("✓ ".concat(t.message||e("pdf.processSuccess")))}else D(t.error||e("pdf.processError"))}catch(t){console.error("PDF processing error:",t),D(t.message||e("pdf.processError"))}finally{S(!1)}}},[u,y,P,A,X,e]),el=(0,s.useCallback)(()=>{(!(y.reduce((e,t)=>e+t.length,0)>0)||window.confirm(e("common.confirmBack")))&&(x(null),p(0),f(1),v([]),a("upload"),X())},[y,X,e]),en=(0,s.useCallback)(async()=>{if(u){X(),Z(e("pdf.reloading"));try{let t=await L(u);t.success?Z(e("pdf.reloadSuccess")):D(t.error||e("pdf.reloadError"))}catch(t){D(t.message||e("pdf.reloadError"))}}},[u,L,X,e]),ei=y.reduce((e,t)=>e+t.length,0),eo=(0,s.useMemo)(()=>({totalRedactions:ei,pageStats:y.map((e,t)=>({page:t+1,count:e.length})).filter(e=>e.count>0),currentMethod:({canvas:{name:e("process.canvas"),description:e("process.canvas.desc"),pros:e("process.canvas.pros"),cons:e("process.canvas.cons"),security:5,color:"green"},pixelate:{name:e("process.pixelate"),description:e("process.pixelate.desc"),pros:e("process.pixelate.pros"),cons:e("process.pixelate.cons"),security:3,color:"yellow"}})[P],totalPages:m}),[y,P,m,e]);return((0,s.useEffect)(()=>{X();let e=e=>{!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&(e.ctrlKey&&"z"===e.key&&!e.shiftKey&&(e.preventDefault(),K()),(e.ctrlKey&&"y"===e.key||e.ctrlKey&&e.shiftKey&&"z"===e.key)&&(e.preventDefault(),Q()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[X,K,Q]),J)?(0,r.jsxs)("div",{className:"flex flex-col w-full h-[calc(100vh-64px)] overflow-hidden",translate:"no",children:["editor"===t&&(0,r.jsxs)("div",{className:"bg-white border-b-2 border-black px-4 py-2 sticky top-0 z-40 shadow-sm flex justify-between items-center shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("button",{onClick:el,className:"neo-btn-sm bg-white hover:bg-gray-100 flex items-center",children:[(0,r.jsx)(n.Z,{className:"w-4 h-4 mr-1.5"}),e("app.back")]}),(0,r.jsx)("div",{className:"h-6 w-0.5 bg-black mx-2"}),(0,r.jsx)("button",{onClick:en,disabled:H,className:"neo-btn-sm bg-white hover:bg-gray-100 disabled:opacity-50",title:e("action.reload"),children:(0,r.jsx)(i.Z,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[0===ei&&(0,r.jsxs)("div",{className:"hidden sm:flex items-center text-xs font-bold text-blue-800 bg-blue-100 border-2 border-blue-800 px-2 py-1 shadow-[2px_2px_0px_0px_rgba(30,64,175,1)]",children:[(0,r.jsx)(o.Z,{className:"w-3 h-3 mr-1"}),e("app.subtitle")]}),ei>0&&ei<3&&(0,r.jsxs)("div",{className:"hidden sm:flex items-center text-xs font-bold text-green-800 bg-green-100 border-2 border-green-800 px-2 py-1 shadow-[2px_2px_0px_0px_rgba(22,101,52,1)]",children:[(0,r.jsx)(c.Z,{className:"w-3 h-3 mr-1"}),e("pdf.canPreview")]})]})]}),(q||M)&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"neo-box max-w-md w-full mx-4 overflow-hidden animate-in slide-in-from-bottom-4 duration-300",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center mb-4",children:[(0,r.jsx)("div",{className:"animate-spin w-6 h-6 border-4 border-black border-t-transparent rounded-full mr-3"}),(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:q?"loading"===q.stage?e("common.loading"):"rendering"===q.stage?e("process.rendering"):"processing"===q.stage?e("action.processing"):e("process.finishing"):e("action.processing")})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-bold text-gray-600",children:q?q.message:e("process.processingPdf")}),(0,r.jsx)("span",{className:"text-sm font-black text-gray-800",children:q?"".concat(Math.round(q.progress),"%"):""})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 border-2 border-black h-4 rounded-none",children:(0,r.jsx)("div",{className:"bg-[#FFDE00] h-full transition-all duration-200 ease-out border-r-2 border-black",style:{width:q?"".concat(q.progress,"%"):"20%"}})}),(null==q?void 0:q.currentPage)&&(null==q?void 0:q.totalPages)&&(0,r.jsx)("div",{className:"text-xs font-bold text-gray-500 mt-2 text-center",children:e("pdf.pageProgress",{current:q.currentPage,total:q.totalPages})})]}),(0,r.jsx)("p",{className:"text-xs font-bold text-gray-500 text-center",children:e("process.warning")})]})})}),U&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"neo-box max-w-6xl w-full mx-4 h-[90vh] flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 border-b-2 border-black bg-yellow-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-xl font-black text-gray-900 flex items-center",children:[(0,r.jsx)(d.Z,{className:"w-6 h-6 text-black mr-2"}),e("preview.title")]}),(0,r.jsx)("button",{onClick:()=>T(!1),className:"neo-btn-sm bg-white hover:bg-red-100 text-black",children:(0,r.jsx)(n.Z,{className:"w-5 h-5"})})]}),(0,r.jsx)("p",{className:"text-sm font-bold text-gray-700 mt-2",children:e("preview.description")})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden bg-gray-100",children:(0,r.jsx)(z,{file:u,onRenderPage:B,redactionRects:y,onAddRedactionRect:()=>{},onRemoveRedactionRect:()=>{},setRedactionRects:()=>{},currentPage:b,totalPages:m,onPageChange:f,loading:H,previewMode:!0,redactionMethod:P})}),(0,r.jsx)("div",{className:"p-4 border-t-2 border-black bg-white",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm font-bold text-gray-600",children:[(0,r.jsx)("span",{children:e("pdf.currentPage",{current:b,total:m})}),(0,r.jsx)("span",{children:"•"}),(0,r.jsx)("span",{children:e("preview.redactionCount",{count:eo.totalRedactions})}),(0,r.jsx)("span",{children:"•"}),(0,r.jsx)("span",{children:e("preview.method",{method:eo.currentMethod.name})})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{onClick:()=>T(!1),className:"neo-btn bg-white hover:bg-gray-100",children:e("preview.continueEdit")}),(0,r.jsx)("button",{onClick:()=>{T(!1),eo.totalRedactions>0&&es()},disabled:0===eo.totalRedactions||M,className:"neo-btn bg-black text-white hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:M?e("action.processing"):e("preview.confirmProcess")})]})]})})]})}),(E||F)&&(0,r.jsxs)("div",{className:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[70] max-w-lg w-full mx-4 animate-in slide-in-from-top-4 duration-300",children:[E&&(0,r.jsx)("div",{className:"neo-box border-red-500 bg-red-50 p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(o.Z,{className:"w-5 h-5 text-red-600 mr-3 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-red-900 text-sm font-black",children:e("action.error")}),(0,r.jsx)("p",{className:"text-red-800 text-sm mt-1 font-medium",children:E})]}),(0,r.jsx)("button",{onClick:X,className:"ml-4 text-red-500 hover:text-red-700 font-bold",children:(0,r.jsx)(n.Z,{className:"w-4 h-4"})})]})}),F&&(0,r.jsx)("div",{className:"neo-box border-green-500 bg-green-50 p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5 text-green-600 mr-3 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-green-900 text-sm font-black",children:e("action.success")}),(0,r.jsx)("p",{className:"text-green-800 text-sm mt-1 font-medium",children:F})]}),(0,r.jsx)("button",{onClick:X,className:"ml-4 text-green-500 hover:text-green-700 font-bold",children:(0,r.jsx)(n.Z,{className:"w-4 h-4"})})]})})]}),(0,r.jsx)("main",{className:"flex-1 w-full overflow-hidden",children:"upload"===t?(0,r.jsxs)("div",{className:"h-full overflow-auto flex flex-col items-center justify-center p-6 bg-[#f0f0f0] relative",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4",children:(0,r.jsx)($.$,{})}),(0,r.jsxs)("div",{className:"max-w-4xl w-full",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsxs)(g.default,{href:"/",className:"inline-flex items-center text-gray-500 hover:text-black mb-6 font-bold transition-colors",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),e("app.back")]}),(0,r.jsx)("h1",{className:"text-4xl font-black text-gray-900 mb-2",children:e("upload.title")}),(0,r.jsx)("p",{className:"text-xl text-gray-600 font-medium",children:e("upload.description")})]}),(0,r.jsx)("div",{className:"neo-box p-8 mb-8",children:(0,r.jsx)(w,{onFileSelect:Y,loading:H,error:""})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"neo-box-sm p-4 flex items-center justify-center",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5 mr-2 text-blue-600"}),(0,r.jsx)("span",{className:"font-bold text-sm",children:e("fileUploader.localProcessing")})]}),(0,r.jsxs)("div",{className:"neo-box-sm p-4 flex items-center justify-center",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5 mr-2 text-green-600"}),(0,r.jsx)("span",{className:"font-bold text-sm",children:e("fileUploader.pdfOnly")})]}),(0,r.jsxs)("div",{className:"neo-box-sm p-4 flex items-center justify-center",children:[(0,r.jsx)(o.Z,{className:"w-5 h-5 mr-2 text-yellow-600"}),(0,r.jsx)("span",{className:"font-bold text-sm",children:e("fileUploader.maxSize")})]})]})]})]}):(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row h-full",children:[(0,r.jsx)("div",{className:"flex-1 min-h-0 bg-gray-100/50 relative",children:(0,r.jsx)(z,{file:u,onRenderPage:B,redactionRects:y,onAddRedactionRect:ee,onRemoveRedactionRect:et,setRedactionRects:v,currentPage:b,totalPages:m,onPageChange:f,loading:H})}),(0,r.jsx)("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t-2 border-black shadow-lg z-40",children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-2",children:[(0,r.jsx)("div",{className:"text-xs font-bold text-gray-600",children:e("toolbar.marks",{count:ei})}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:K,disabled:k<=0||M,className:"neo-btn-sm bg-white text-gray-800 disabled:opacity-50",children:e("toolbar.undo")}),(0,r.jsx)("button",{onClick:Q,disabled:k>=j.length-1||M,className:"neo-btn-sm bg-white text-gray-800 disabled:opacity-50",children:e("toolbar.redo")}),(0,r.jsx)("button",{onClick:es,disabled:!ei||M,className:"neo-btn-sm bg-blue-600 text-white disabled:opacity-50",children:M?e("action.processing"):e("toolbar.generate")})]})]})}),(0,r.jsx)("div",{className:"hidden lg:block h-full border-l-2 border-black bg-white w-80 shrink-0 overflow-y-auto",children:(0,r.jsx)(I,{redactionMethod:P,onMethodChange:e=>R(e),onProcess:es,onClear:ea,onPreview:er,onUndo:K,onRedo:Q,processing:M,hasRedactions:ei>0,canUndo:k>0,canRedo:k<j.length-1,selectedColor:W,onColorChange:_})})]})})]}):(0,r.jsx)("div",{className:"h-[calc(100vh-64px)] flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center max-w-md mx-auto p-6 neo-box",children:[(0,r.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-black border-t-transparent rounded-full mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:e("app.initializing")}),(0,r.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:e("app.initializingDesc")})]})})}},4590:function(e,t,a){"use strict";a.d(t,{$:function(){return i}});var r=a(7437),s=a(2265),l=a(3949);let n=[{code:"en",name:"English",flag:"US"},{code:"zh",name:"中文",flag:"CN"},{code:"fr",name:"Fran\xe7ais",flag:"FR"}],i=()=>{let{i18n:e,t}=(0,l.$G)(),[a,i]=s.useState(!1),o=t=>{e.changeLanguage(t),i(!1)},c=(()=>{let t=n.find(t=>t.code===e.language);if(t)return t;let a=e.language.split("-")[0];return n.find(e=>e.code===a)||n.find(e=>"en"===e.code)||n[0]})();return(0,r.jsxs)("div",{className:"relative inline-block text-left",children:[(0,r.jsxs)("button",{onClick:()=>i(!a),className:"inline-flex items-center px-3 py-2 border border-gray-200 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 min-w-[100px]","aria-haspopup":"true","aria-expanded":a,children:[(0,r.jsx)("span",{className:"text-xs font-bold mr-2 text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded",children:c.flag}),(0,r.jsx)("span",{className:"inline text-sm font-medium",children:c.name}),(0,r.jsx)("svg",{className:"ml-2 -mr-1 h-4 w-4 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),(0,r.jsx)("div",{className:"origin-top-right absolute right-0 mt-2 w-52 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-20",children:(0,r.jsxs)("div",{className:"py-1",role:"menu","aria-orientation":"vertical",children:[(0,r.jsx)("div",{className:"px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-100",children:t("language.selector")}),n.map(t=>(0,r.jsxs)("button",{onClick:()=>o(t.code),className:"\n                    w-full text-left px-4 py-3 text-sm transition-colors flex items-center\n                    ".concat(e.language===t.code?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-100","\n                  "),role:"menuitem",children:[(0,r.jsx)("span",{className:"mr-3 text-xs font-bold text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded w-8 text-center",children:t.flag}),(0,r.jsx)("span",{className:"flex-1 font-medium",children:t.name}),e.language===t.code&&(0,r.jsx)("span",{className:"ml-2 text-blue-600 font-bold",children:"✓"})]},t.code))]})})]})]})}}},function(e){e.O(0,[980,949,216,15,971,117,744],function(){return e(e.s=6307)}),_N_E=e.O()}]);